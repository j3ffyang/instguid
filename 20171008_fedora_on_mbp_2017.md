## Document Objective
- Install latest (up to this document made) Fedora 27 beta on MacBook Pro 2017 14,2
- Fix touchbar, keyboard and touchpad issues

#### Document Reference
- [Linux on MBP Late 2016 by github.com/roadrunner2](https://gist.github.com/roadrunner2/1289542a748d9a104e7baec6a92f9cd7)

#### Pre- requisite
- ```yum install git kernel-devel-$(uname -r) elfutils-libelf-devel```

## keyboard/ Touchpad/ Touchbar

For this we need the drivers from https://github.com/roadrunner2/macbook12-spi-driver.git (a clone of https://github.com/cb22/macbook12-spi-driver which includes a preliminary touchbar driver and keyboard fixes). The following commands set this up.

```
git clone https://github.com/roadrunner2/macbook12-spi-driver.git

[jeff@fedora ~]$ pushd macbook12-spi-driver/
~/macbook12-spi-driver ~
[jeff@fedora macbook12-spi-driver]$ git checkout touchbar-driver-hid-driver
Already on 'touchbar-driver-hid-driver'
Your branch is up-to-date with 'origin/touchbar-driver-hid-driver'.
[jeff@fedora macbook12-spi-driver]$ make
make -C /lib/modules/4.13.5-300.fc27.x86_64/build M=/home/jeff/macbook12-spi-driver modules
make[1]: Entering directory '/usr/src/kernels/4.13.5-300.fc27.x86_64'
Makefile:940: "Cannot use CONFIG_STACK_VALIDATION, please install libelf-dev, libelf-devel or elfutils-libelf-devel"
  Building modules, stage 2.
  MODPOST 2 modules
make[1]: Leaving directory '/usr/src/kernels/4.13.5-300.fc27.x86_64'
[jeff@fedora macbook12-spi-driver]$ sudo mkdir /lib/modules
modules/        modules-load.d/
[jeff@fedora macbook12-spi-driver]$ sudo mkdir /lib/modules
modules/        modules-load.d/
[jeff@fedora macbook12-spi-driver]$ sudo mkdir /lib/modules/`uname -r`/custom/
[sudo] password for jeff:
[jeff@fedora macbook12-spi-driver]$ sudo cp applespi.ko appletb.ko /lib/modules/`uname -r`/custom/
[jeff@fedora macbook12-spi-driver]$ sudo depmod
[jeff@fedora macbook12-spi-driver]$ popd
~
[jeff@fedora ~]$
```

Next we need to set the proper dpi for the touchpad (download the [61-evdev-local.hwdb](https://gist.github.com/roadrunner2/1289542a748d9a104e7baec6a92f9cd7#file-61-evdev-local-hwdb) from this gist):

```
sudo cp 61-evdev-local.hwdb /etc/udev/hwdb.d/
```

Test the drivers by loading them and their dependencies:

```
sudo modprobe intel_lpss_pci spi_pxa2xx_platform applespi appletb
```

You'll want these loaded on boot, so rebuild the initramfs (download the [keyboard.conf](https://gist.github.com/roadrunner2/1289542a748d9a104e7baec6a92f9cd7#file-keyboard-conf) from this gist):

```
[jeff@fedora ~]$ sudo mv /boot/initramfs-`uname -r`.img{,.orig}
[jeff@fedora ~]$ sudo cp keyboard.conf /etc/dracut.conf.d/keyboard.conf
[jeff@fedora ~]$ sudo dracut
```

Then reboot to take the change effective

## ```firewalld``` taking long time during shutdown
#### Reference
- [Change ```firewalld.conf```](https://bugzilla.redhat.com/show_bug.cgi?id=1294415#c10)
Set ```CleanupOnExit``` to ```no```
